<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at Mar 6, 2013
 | Rendered using Apache Maven Fluido Skin 1.3.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Nick Jones" />
    <meta name="Date-Revision-yyyymmdd" content="20130306" />
    <meta http-equiv="Content-Language" content="en" />
    <title>ITK API and Reference Implementation - 
    ITK API and reference implementation</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.0.min.js"></script>

                          
        
<link rel="stylesheet" href="css/itk-mini-site.css"></link>
                      
        
<link rel="stylesheet" type="text/css" href="js/prettify.css"></link>
                      
        
<script src="js/prettify.js" type="text/javascript"></script>
                      
        
<script src="js/itk-api-site.js" type="text/javascript"></script>
          
            </head>
        <body class="topBarEnabled">
          
                        
                    
                

    <div id="topbar" class="navbar navbar-fixed-top navbar-inverse">
      <div class="navbar-inner">
                                  <div class="container"><div class="nav-collapse">
            
                
                                                                                <a class="brand" href="index.html"  title="IRK">

                                
                                                                                                                    <img src="images/itk-small.gif" alt="IRK" />
                
                </a>
                    
                                <ul class="nav">
                          <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Scenarios <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="scenarios-overview.html"  title="Scenarios Overview">Scenarios Overview</a>
</li>
                  
                      <li class="dropdown-submenu">
                                      <a href="scenarios-overview.html#Synchronous"  title="Synchronous">Synchronous</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="sync-query-sender.html"  title="Spine Mini-Services (client)">Spine Mini-Services (client)</a>
</li>
                                  <li>      <a href="sync-query-receiver.html"  title="Spine Mini-Services (provider)">Spine Mini-Services (provider)</a>
</li>
                                  <li>      <a href="simple-sync-fireandforget.html"  title="ADT Admit Patient (P/H)">ADT Admit Patient (P/H)</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="scenarios-overview.html#Simple Asynchronous"  title="Simple Asynchronous">Simple Asynchronous</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="simple-async-adt-query.html"  title="ADT Query patient (XML)">ADT Query patient (XML)</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="scenarios-overview.html#Routed Message"  title="Routed Message">Routed Message</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="routed-cda-document-repo.html"  title="Routed CDA (document repository)">Routed CDA (document repository)</a>
</li>
                                  <li>      <a href="routed-cda-with-business-ack.html"  title="Routed CDA (with business Ack)">Routed CDA (with business Ack)</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Project Reports <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li class="dropdown-submenu">
                                      <a href="project-info.html"  title="Project Information">Project Information</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="index.html"  title="About">About</a>
</li>
                                  <li>      <a href="team-list.html"  title="Project Team">Project Team</a>
</li>
                                  <li>      <a href="issue-tracking.html"  title="Issue Tracking">Issue Tracking</a>
</li>
                                  <li>      <a href="modules.html"  title="Project Modules">Project Modules</a>
</li>
                                  <li>      <a href="license.html"  title="Project License">Project License</a>
</li>
                              </ul>
            </li>
                  
                      <li class="dropdown-submenu">
                                      <a href="project-reports.html"  title="Project Reports">Project Reports</a>
              <ul class="dropdown-menu">
                                  <li>      <a href="apidocs/index.html"  title="JavaDocs">JavaDocs</a>
</li>
                                  <li>      <a href="xref/index.html"  title="Source Xref">Source Xref</a>
</li>
                              </ul>
            </li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Modules <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="../itk-api/index.html"  title="ITK API">ITK API</a>
</li>
                  
                      <li>      <a href="../itk-ri/index.html"  title="ITK Java Reference Implementation">ITK Java Reference Implementation</a>
</li>
                  
                      <li>      <a href="../itk-samples/index.html"  title="ITK Samples project">ITK Samples project</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Reference <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="requirements-cross-ref.html"  title="ITK Requirement traceability">ITK Requirement traceability</a>
</li>
                  
                      <li>      <a href="../itk-api/apidocs/index.html"  title="Javadocs (API only)">Javadocs (API only)</a>
</li>
                  
                      <li>      <a href="apidocs/index.html"  title="Javadocs (API + RI + Samples)">Javadocs (API + RI + Samples)</a>
</li>
                  
                      <li>      <a href="xref/index.html"  title="Java source cross-reference">Java source cross-reference</a>
</li>
                  
                      <li>      <a href="../itk-samples/downloads.html"  title="Downloads">Downloads</a>
</li>
                  
                      <li>      <a href="../itk-samples/index.html"  title="Install Guide">Install Guide</a>
</li>
                  
                      <li>      <a href="docs/ITK Basic Workshop v0.1 - Webex.pdf"  target="_blank" title="ITK Basic Workshop - Webex Slides">ITK Basic Workshop - Webex Slides</a>
</li>
                          </ul>
      </li>
                <li class="dropdown">
        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Disclaimer <b class="caret"></b></a>
        <ul class="dropdown-menu">
        
                      <li>      <a href="disclaimer.html"  title="Disclaimer">Disclaimer</a>
</li>
                          </ul>
      </li>
                  </ul>
          
          
                                                              
                               <ul class="nav pull-right">
              <li class="dropdown">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">External Links <b class="caret"></b></a>
                <ul class="dropdown-menu">
                      <li>      <a href="http://services.developer.nhs.uk/itk-samples/"  title="ITK RI (Running samples)">ITK RI (Running samples)</a>
</li>
      <li>      <a href="http://www.connectingforhealth.nhs.uk/systemsandservices/interop"  title="CFH ITK home page">CFH ITK home page</a>
</li>
      <li>      <a href="http://www.connectingforhealth.nhs.uk/systemsandservices/interop/fund"  title="ISCF">ISCF</a>
</li>
      <li>      <a href="http://www.uktcregistration.nss.cfh.nhs.uk/trud3/user/guest/group/0/pack/21"  title="ITK @ TRUD">ITK @ TRUD</a>
</li>
      <li>      <a href="http://www.networks.nhs.uk/nhs-networks/interoperability-toolkit-itk"  title="ITK @ NHS Networks">ITK @ NHS Networks</a>
</li>
      <li>      <a href="http://www.linkedin.com/groups/NHS-Interoperability-Toolkit-3831338"  title="ITK @ LinkedIn">ITK @ LinkedIn</a>
</li>
                  </ul>
              </li>
            </ul>
          
                      </div>
          
        </div>
      </div>
    </div>
    
        <div class="container">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>ITK API and Reference Implementation mini-site</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
            
                
                    
      
                            </ul>
      </div>

      
                
        <div id="bodyColumn" >
                                  
            
 
  
    <div id="container">
    <div id="bodyColumn">
           <div class="section">
                <div class="section"><h2><a name="ADT_Admit_Patient_-_Pipe_and_Hat_format_-_Synchronous"></a>ADT Admit Patient - Pipe and Hat format - Synchronous</h2>
		        <ul class="nav nav-tabs tab-control">
				  <li class="active"><a href="#overview">Overview</a></li>
				  <li><a href="#sender">Sender</a></li>
				  <li><a href="#receiver">Receiver</a></li>
				  <li><a href="#request">Request</a></li>
				  <li><a href="#response">Response</a></li>
				</ul>
           </div>
     </div>

<!-- a href="#" id="example" class="btn btn-success" rel="popover">Hover over me! Please Don't Click</a -->


<div class="row-fluid" style="height:325px">
    <div class="span5">
      <p class="tab-title">Black Box View</p>
   
       <div class="clickablemapview">
	        <img src="images/ADT - Synchronous - blackbox.jpg" alt="" usemap="#bbviewmap" />
	        <map name="bbviewmap" id="bbviewmap">
	           <area shape="rect" coords="25,35,112,84" alt="" title="Sender" href="#sender"></area>
	           <area shape="rect" coords="284,35,373,84" alt="" title="Receiver" href="#receiver"></area>
	           <area shape="rect" coords="80,118,320,143" alt="" title="Request" href="#request"></area>
	           <area shape="rect" coords="80,160,320,185" alt="" title="Response" href="#response"></area>
	        </map>
        </div>    
    </div>
    <div class="span7">
        <div class="tab-content">
  <div class="tab-pane active" id="overview">
        <p class="tab-title">Overview</p>
        <p>
        The scenario shows a simple synchronous interaction between sender and receiver, as previously described in the SMSP examples.
        This example is drawn out to show how the ITK Reference Implementation manages the transmission of messages in non-xml format. 
        In this case an HL7v2 ADT message in traditional &quot;pipe and hat&quot; format is packaged up
        and sent over the wire with no implications for the sending application and very little
        configuration. Although not shown here, the implications for the receiver are similarly simple.
        </p>
  </div>
  <div class="tab-pane" id="sender">
        <p class="tab-title">Sender View</p>
        <p>
        The Sender builds a <tt>SimpleMessage</tt> using a String containing the p/h ADT message. Configuration of the service tells
        the R.I. that this messages requires base64 encoding so the RI performs the encoding and builds the DistributionEnvelope with the appropriate
        tagging.
        </p>
  </div>
  <div class="tab-pane" id="receiver">
        <p class="tab-title">Receiver View</p>
        <p>
            The Receiver consumers the SOAP message. This validates the SOAP headers and then extracts the payload. The SOAP payload is then split further
            into Distribution Envelope and business payload. The Distribution Envelope is validated and extracted into <tt>MessageProperties</tt>.
            The R.I. then looks up the service properties from the configuration and - in this case - as the payload is in base64 form it is decoded before
            being packaged up as a <tt>SimpleMessage</tt> and passed onto the Application Message Handler.
            </p>
  </div>
  <div class="tab-pane" id="request">
      <p class="tab-title">Request Message
      <a href="samples/A01.xml" target="_blank" type="text/xml">(Get example)</a></p>
		<div class="source">
			<div><pre class="prettyprint">
&lt;soap:Envelope xmlns:itk=&quot;urn:nhs-itk:ns:201005&quot; ... &gt;
 &lt;soap:Header&gt; ... &lt;/soap:Header&gt;
 &lt;soap:Body&gt;
  &lt;itk:DistributionEnvelope ... &gt;
   &lt;itk:header service=&quot;urn:nhs-itk:services:201005:admitPatientPH-v1-0&quot; ...&gt;
    ...
   &lt;/itk:header&gt;
   &lt;itk:payloads count=&quot;1&quot;&gt;
    &lt;itk:payload id=&quot;...&quot;&gt;TVNIfF5+X ... 4MTIzNHwNCg== &lt;/itk:payload&gt;
   &lt;/itk:payloads&gt;
  &lt;/itk:DistributionEnvelope&gt;
 &lt;/soap:Body&gt;
&lt;/soap:Envelope&gt;</pre></div>
		</div>
  </div>
  <div class="tab-pane" id="response">
      <p class="tab-title">Simple Message Response
      <a href="samples/SMR.xml" target="_blank" type="text/xml">(Get example)</a></p>
		<div class="source">
			<div><pre class="prettyprint">
&lt;itk:manifest count=&quot;1&quot;&gt;
        &lt;itk:manifestitem base64=&quot;true&quot;
            id=&quot;uuid_6e9306ba-9a09-4479-a719-fcc23234b9ec&quot;
            mimetype=&quot;text/plain&quot; profileid=&quot;ITKv1.0&quot;/&gt;
    &lt;/itk:manifest&gt;
    &lt;itk:senderAddress uri=&quot;urn:nhs-uk:addressing:ods:TESTORGS:ORGA&quot;/&gt;
&lt;/itk:header&gt;
&lt;itk:payloads count=&quot;1&quot;&gt;
   &lt;itk:payload id=&quot;uuid_6e9306ba-9a09-4479-a719-fcc23234b9ec&quot;&gt;TVNIfF5+XCZ8...
    ....HwNCg==&lt;/itk:payload&gt;
&lt;/itk:payloads&gt;</pre></div>
		</div>
      
  </div>
</div>
    </div>
</div>
   <div id="bodyColumn3">
          <div class="section">
               <div class="section"><h2>How it all happens....<a name="How_it_all_happens...."></a></h2>
	        <ul class="nav nav-tabs tab-control">
			  <li class="active"><a href="#step1">Step 1</a></li>
			  <li><a href="#step2">Step 2</a></li>
			  <li><a href="#step3">Step 3</a></li>
			  <li><a href="#step4">Step 4</a></li>
			</ul>
          </div>
    </div>

       <div class="tab-content">
<div class="row-fluid tab-pane active" id="step1">
	<div class="span5"><p></p>
	    <p><span class="label label-important label-large">Step 1</span> </p>

		<p>The sending application code doesn't need to know that the message in in pipe and hat
		format - it just builds a message, sets the serviceId and sends it, as in the previous synchronous examples.</p>
		<p>The full <a href="xref/uk/nhs/interoperability/client/samples/adt/ADTServlet.html#45">source code for the ADT Servlet can be seen here</a>.</p>
		
	</div>

	<div class="span7">
		<div class="source">
			<div><pre class="prettyprint">
// Create the message
ITKMessage msg = new SimpleMessage();
msg.setBusinessPayload(phMessage);
...
mp.setServiceId(&quot;urn:nhs-itk:services:201005:admitPatientPH-v1-0&quot;);
...
// Send this message synchronously.
ITKMessage responseMsg = sender.sendSync(msg);</pre></div>
		</div>

	</div>

</div>
<div class="row-fluid tab-pane" id="step2">
	<div class="span5"><p></p>
	    <p><span class="label label-important label-large">Step 2</span> </p>
		<p>
		A raw HL7v2 message in p/h format would not be valid data if just wrapped up in
		XML, so the ITK R.I. needs to know that this message is p/h so that it can construct the on-the-wire message accordingly.
		The R.I. uses a <tt>service.properties</tt> file to contain service configurations such as this.
		</p>
	</div>
	<div class="span7">

		<div class="source">
			<div><pre class="prettyprint">

urn\:nhs-itk\:services\:201005\:admitPatientPH-v1-0.isBase64=Y
urn\:nhs-itk\:services\:201005\:admitPatientPH-v1-0.mimeType=text/plain
			</pre></div>
		</div>

	</div>


</div>
<div class="row-fluid tab-pane" id="step3">
	<div class="span5"><p></p>
	    <p><span class="label label-important label-large">Step 3</span> </p>
		<p>
		The Reference Implementation uses the service configuration to 
		encode the message using core java language conversions.		</p>
	</div>
	<div class="span7">

		<div class="source">
			<div><pre class="prettyprint">
if(service.isBase64()){
	String b64DocText = javax.xml.bind.DatatypeConverter.
  		printBase64Binary(request.getBusinessPayload().getBytes());
	request.setBusinessPayload(b64DocText);
}
message = new DEWrappedMessage(service, request, true);
			</pre></div>
		</div>

	</div>

</div>

<div class="row-fluid tab-pane" id="step4">
	<div class="span5"><p></p>
	    <p><span class="label label-important label-large">Step 4</span> </p>
		<p>
		Now the R.I. sets the mime type, base64 encoding to the appropriate values
		and embeds the encoded message as the payload.
		</p>
	</div>
	<div class="span7">

		<div class="source">
			<div><pre class="prettyprint">
	&lt;itk:manifest count=&quot;1&quot;&gt;
		&lt;itk:manifestitem base64=&quot;true&quot;
			id=&quot;uuid_6e9306ba-9a09-4479-a719-fcc23234b9ec&quot;
			mimetype=&quot;text/plain&quot; profileid=&quot;ITKv1.0&quot;/&gt;
	&lt;/itk:manifest&gt;
	&lt;itk:senderAddress uri=&quot;urn:nhs-uk:addressing:ods:TESTORGS:ORGA&quot;/&gt;
&lt;/itk:header&gt;
&lt;itk:payloads count=&quot;1&quot;&gt;
   &lt;itk:payload id=&quot;uuid_6e9306ba-9a09-4479-a719-fcc23234b9ec&quot;&gt;TVNIfF5+XCZ8...
	....HwNCg==&lt;/itk:payload&gt;
&lt;/itk:payloads&gt;
			</pre></div>
		</div>

	</div>


</div>

</div>

</div>


                  </div>
          </div>

    <hr/>

    <footer>
            <div class="container">
              <div class="row span12">All content is available under the <a href="http://www.nationalarchives.gov.uk/doc/open-government-licence/" title="Open Government Licence">Open Government Licence</a>, except where otherwise stated<br/>
                                  All example source code is available under <a href="http://www.apache.org/licenses/LICENSE-2.0.html" title="Apache 2.0 License">Apache 2.0</a>, except where otherwise stated      
                    
                  <li id="publishDate" class="pull-right">Last Published: 2013-03-06</li> 
              <li id="projectVersion" class="pull-right">Version: 0.1-SNAPSHOT</li>
            </div>

        
                <p id="poweredBy" class="pull-right">
                                                                                                                      <a href="http://www.connectingforhealth.nhs.uk/systemsandservices/interop" title="ITK" class="builtBy">
        <img class="builtBy"  alt="ITK" src="images/itk-logo-2.png"    />
      </a>
                  </p>
        
                </div>
    </footer>
  </body>
</html>
